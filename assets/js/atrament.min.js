var Atrament=function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){t.exports=n(1)},function(t,e,n){t.exports=n(2)},function(t,e,n){function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function i(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function a(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var u=n(3),h=u.Mouse,l=u.Point,f=n(4),p=n(5).AtramentEventTarget,y=n(6);t.exports=function(t){function e(t){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),"undefined"==typeof window)throw new Error("Looks like we're not running in a browser");if(n=a(this,s(e).call(this)),t instanceof window.Node&&"CANVAS"===t.tagName)n.canvas=t;else{if("string"!=typeof t)throw new Error("can't look for canvas based on '".concat(t,"'"));n.canvas=document.querySelector(t)}if(!n.canvas)throw new Error("canvas not found");n.canvas.width=o.width||n.canvas.width,n.canvas.height=o.height||n.canvas.height,n.mouse=new h;var r=function(t){t.cancelable&&t.preventDefault();var e=n.canvas.getBoundingClientRect(),o=t.changedTouches&&t.changedTouches[0]||t,r=o.offsetX,i=o.offsetY;void 0===r&&(r=o.clientX-e.left),void 0===i&&(i=o.clientY-e.top),n.mouse.down&&"draw"===n._mode?(n.draw(r,i),n.recordStrokes&&n.strokeMemory.push(new l(r,i)),n._dirty||r===n.mouse.x&&i===n.mouse.y||(n._dirty=!0,n.fireDirty())):n.mouse.set(r,i)},i=function(t){t.cancelable&&t.preventDefault(),r(t),"fill"!==n._mode?(n.mouse.px=n.mouse.x,n.mouse.py=n.mouse.y,n.mouse.down=!0,n.beginDrawing()):n.fill()},c=function(t){if("fill"!==n.mode){var e=t.changedTouches&&t.changedTouches[0]||t,o=e.offsetX,r=e.offsetY;n.mouse.down=!1,n.mouse.x===o&&n.mouse.y===r&&"draw"===n.mode&&n.draw(n.mouse.x,n.mouse.y),n.stopDrawing()}};return n.canvas.addEventListener("mousemove",r),n.canvas.addEventListener("mousedown",i),document.addEventListener("mouseup",c),n.canvas.addEventListener("touchstart",i),n.canvas.addEventListener("touchend",c),n.canvas.addEventListener("touchmove",r),n.destroy=function(){n.clear(),n.canvas.removeEventListener("mousemove",r),n.canvas.removeEventListener("mousedown",i),document.removeEventListener("mouseup",c),n.canvas.removeEventListener("touchstart",i),n.canvas.removeEventListener("touchend",c),n.canvas.removeEventListener("touchmove",r)},n.context=n.canvas.getContext("2d"),n.context.globalCompositeOperation="source-over",n.context.globalAlpha=1,n.context.strokeStyle=o.color||"rgba(0,0,0,1)",n.context.lineCap="round",n.context.lineJoin="round",n.context.translate(.5,.5),n._filling=!1,n._fillStack=[],n.recordStrokes=!1,n.strokeMemory=[],n.smoothing=f.initialSmoothingFactor,n._thickness=f.initialThickness,n._targetThickness=n._thickness,n._weight=n._thickness,n._maxWeight=n._thickness+f.weightSpread,n._mode="draw",n.adaptiveStroke=!0,["weight","smoothing","adaptiveStroke","mode","opacity"].forEach((function(t){return void 0===o[t]?0:n[t]=o[t]})),n}var n,o,u;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(e,t),n=e,(o=[{key:"beginDrawing",value:function(){this.context.beginPath(),this.context.moveTo(this.mouse.px,this.mouse.py),this.dispatchEvent("strokestart",{})}},{key:"stopDrawing",value:function(){if(this.context.closePath(),this.dispatchEvent("strokeend",{}),this.recordStrokes){var t={points:this.strokeMemory.slice(),weight:this.weight,opacity:this.opacity,smoothing:this.smoothing,color:this.color,adaptiveStroke:this.adaptiveStroke};this.dispatchEvent("strokerecorded",{stroke:t})}this.strokeMemory=[]}},{key:"draw",value:function(t,e){var n=this.mouse,o=this.context,r=y.lineDistance(t,e,n.px,n.py),i=Math.min(f.minSmoothingFactor,this.smoothing+(r-60)/3e3);n.x=t-(t-n.px)*i,n.y=e-(e-n.py)*i;var a=y.lineDistance(n.x,n.y,n.px,n.py);this.adaptiveStroke?(this._targetThickness=(a-f.minLineThickness)/f.lineThicknessRange*(this._maxWeight-this._weight)+this._weight,this._thickness>this._targetThickness?this._thickness-=f.thicknessIncrement:this._thickness<this._targetThickness&&(this._thickness+=f.thicknessIncrement),o.lineWidth=this._thickness):o.lineWidth=this._weight,o.quadraticCurveTo(n.px,n.py,n.x,n.y),o.stroke(),n.px=n.x,n.py=n.y}},{key:"isDirty",value:function(){return!!this._dirty}},{key:"fireDirty",value:function(){this.dispatchEvent("dirty")}},{key:"clear",value:function(){this.isDirty&&(this._dirty=!1,this.dispatchEvent("clean"),"erase"===this.mode?(this.mode="draw",this.context.clearRect(-10,-10,this.canvas.width+20,this.canvas.height+20),this.mode="erase"):this.context.clearRect(-10,-10,this.canvas.width+20,this.canvas.height+20))}},{key:"toImage",value:function(){return this.canvas.toDataURL()}},{key:"fill",value:function(){var t=this,e=this.mouse,n=this.context,o=Array.from(n.getImageData(e.x,e.y,1,1).data);if(this._filling)this._fillStack.push([e.x,e.y,o]);else{var r=e.x,i=e.y;this.dispatchEvent("fillstart",{x:r,y:i}),this._filling=!0,setTimeout((function(){t._floodFill(e.x,e.y,o)}),f.floodFillInterval)}}},{key:"_floodFill",value:function(t,e,n){var o=this.context,i=Math.floor(t),a=Math.floor(e),s=o.canvas.width,c=o.canvas.height,u=[[i,a]],h=y.hexToRgb(this.color),l=o.getImageData(0,0,o.canvas.width,o.canvas.height),f=Math.min(10*o.globalAlpha*255,255),p=y.colorPixel.apply(y,[l.data].concat(r(h),[n,f])),v=y.matchColor.apply(y,[l.data].concat(r(n)));if(y.matchColor.apply(y,[l.data].concat([].concat(r(h),[255])))(4*(a*o.canvas.width+i)))return this._filling=!1,void this.dispatchEvent("fillend",{});for(;u.length;){for(var d=u.pop(),m=d[0],g=d[1],b=4*(g*s+m);g-- >=0&&v(b);)b-=4*s;b+=4*s,++g;for(var w=!1,k=!1;g++<c-1&&v(b);)p(b),m>0&&(v(b-4)?w||(u.push([m-1,g]),w=!0):w&&(w=!1)),m<s-1&&(v(b+4)?k||(u.push([m+1,g]),k=!0):k&&(k=!1)),b+=4*s}o.putImageData(l,0,0),this._fillStack.length?this._floodFill.apply(this,r(this._fillStack.shift())):(this._filling=!1,this.dispatchEvent("fillend",{}))}},{key:"color",get:function(){return this.context.strokeStyle},set:function(t){if("string"!=typeof t)throw new Error("wrong argument type");this.context.strokeStyle=t}},{key:"weight",get:function(){return this._weight},set:function(t){if("number"!=typeof t)throw new Error("wrong argument type");this._weight=t,this._thickness=t,this._targetThickness=t,this._maxWeight=t+f.weightSpread}},{key:"mode",get:function(){return this._mode},set:function(t){if("string"!=typeof t)throw new Error("wrong argument type");switch(t){case"erase":this._mode="erase",this.context.globalCompositeOperation="destination-out";break;case"fill":this._mode="fill",this.context.globalCompositeOperation="source-over";break;default:this._mode="draw",this.context.globalCompositeOperation="source-over"}}},{key:"opacity",set:function(t){if("number"!=typeof t)throw new Error("wrong argument type");this.context.globalAlpha=t>=1?1:t/10}}])&&i(n.prototype,o),u&&i(n,u),e}(p)},function(t,e){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var c=function(){function t(e,n){a(this,t),this.x=e,this.y=n}var e,n,o;return e=t,(n=[{key:"set",value:function(t,e){this.x=t,this.y=e}}])&&s(e.prototype,n),o&&s(e,o),t}(),u=function(t){function e(){var t;return a(this,e),(t=o(this,r(e).call(this,0,0))).down=!1,t.px=0,t.py=0,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}(e,t),e}(c);t.exports={Mouse:u,Point:c}},function(t,e){var n={floodFillInterval:100,maxLineThickness:50,minLineThickness:1};n.lineThicknessRange=n.maxLineThickness-n.minLineThickness,n.thicknessIncrement=.5,n.minSmoothingFactor=.87,n.initialSmoothingFactor=.85,n.weightSpread=10,n.initialThickness=2,t.exports=n},function(t,e){function n(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function o(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var r=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.eventListeners=new Map}var e,r,i;return e=t,(r=[{key:"addEventListener",value:function(t,e){var n=this.eventListeners.get(t)||new Set;n.add(e),this.eventListeners.set(t,n)}},{key:"removeEventListener",value:function(t,e){var n=this.eventListeners.get(t);n&&n.delete(e)}},{key:"dispatchEvent",value:function(t,e){var o=this.eventListeners.get(t);o&&n(o).forEach((function(t){return t(e)}))}}])&&o(e.prototype,r),i&&o(e,i),t}();t.exports={AtramentEventTarget:r}},function(t,e){function n(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}e.lineDistance=function(t,e,n,o){var r=Math.pow(n-t,2),i=Math.pow(o-e,2);return Math.sqrt(r+i)},e.hexToRgb=function(t){var e=t.match(/^#?([\da-f]{2})([\da-f]{2})([\da-f]{2})$/i);return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]},e.matchColor=function(t,e,n,o,r){return function(i){var a=t[i],s=t[i+1],c=t[i+2],u=t[i+3];return a===e&&s===n&&c===o&&u===r}},e.colorPixel=function(t,o,r,i,a,s){var c,u=(c=e).matchColor.apply(c,[t].concat(n(a)));return function(e){t[e]=o,t[e+1]=r,t[e+2]=i,t[e+3]=s,u(e+4)||(t[e+4]=.01*t[e+4]+.99*o,t[e+4+1]=.01*t[e+4+1]+.99*r,t[e+4+2]=.01*t[e+4+2]+.99*i,t[e+4+3]=.01*t[e+4+3]+.99*s),u(e-4)||(t[e-4]=.01*t[e-4]+.99*o,t[e-4+1]=.01*t[e-4+1]+.99*r,t[e-4+2]=.01*t[e-4+2]+.99*i,t[e-4+3]=.01*t[e-4+3]+.99*s)}}}]);
//# sourceMappingURL=atrament.min.js.map
